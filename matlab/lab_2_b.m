% Функция twomodegauss для создания двухмодального гауссового распределения
function p = twomodegauss(mu1, sigma1, mu2, sigma2, A1, A2)
    x = 0:255;  % Диапазон значений интенсивности
    % Два гауссовых распределения
    gauss1 = A1 * exp(-((x - mu1 * 255).^2) / (2 * (sigma1 * 255)^2));
    gauss2 = A2 * exp(-((x - mu2 * 255).^2) / (2 * (sigma2 * 255)^2));
    
    % Сумма и нормализация распределений
    p = (gauss1 + gauss2);
    p = p / sum(p);
end

% Основной скрипт для отображения всех этапов обработки изображения
% Шаг 1: Загрузка изображения
flood = imread('flood.jpg');

% Шаг 2: Отображение исходного изображения и его гистограммы
figure;
imshow(flood);
title('Исходное изображение');

figure;
imhist(flood);
title('Гистограмма исходного изображения');

% Шаг 3: Гистограммная эквализация
flood_eq = histeq(flood);

% Отображение изображения после гистограммной эквализации
figure;
imshow(flood_eq);
title('Изображение после гистограммной эквализации');

figure;
imhist(flood_eq);
title('Гистограмма после гистограммной эквализации');

% Шаг 4: Гистограммная подгонка с twomodegauss
p = twomodegauss(0.3, 0.1, 0.7, 0.1, 1.5, 0.4); % Мягкие параметры
flood_spec = histeq(flood, p);

% Отображение изображения после гистограммной подгонки
figure;
imshow(flood_spec);
title('Изображение после гистограммной подгонки');

figure;
imhist(flood_spec);
title('Гистограмма после гистограммной подгонки');
